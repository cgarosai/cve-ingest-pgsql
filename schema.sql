--
-- PostgreSQL database dump
--

-- Dumped from database version 16.2 (Debian 16.2-1.pgdg120+2)
-- Dumped by pg_dump version 16.3 (Debian 16.3-1+b1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: applicability_analysis; Type: TABLE; Schema: public; 

CREATE TABLE public.applicability_analysis (
    id bigint NOT NULL,
    created_at timestamp without time zone,
    updated_at timestamp without time zone,
    done boolean NOT NULL,
    applicable boolean,
    justification character varying(8191),
    validated boolean,
    cots_id bigint,
    cve_id bigint,
    first_for_id bigint,
    last_updater_id character varying,
    hidden boolean DEFAULT false NOT NULL
);




--
-- Name: applicability_analysis_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.applicability_analysis ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.applicability_analysis_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cots; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cots (
    id bigint NOT NULL,
    created_at timestamp without time zone,
    name character varying(255),
    obsolete_at date,
    updated_at timestamp without time zone,
    version character varying(255),
    cpe character varying(255),
    to_analyse boolean DEFAULT false NOT NULL
);



--
-- Name: cots_cves; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cots_cves (
    cots_id bigint NOT NULL,
    cves_id bigint NOT NULL
);




--
-- Name: cots_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cots ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cots_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cots_informations; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cots_informations (
    id bigint NOT NULL,
    content character varying(65000),
    created_at timestamp without time zone,
    schema_version character varying(255),
    type character varying(255),
    updated_at timestamp without time zone,
    cots_id bigint,
    first_for_id bigint,
    exposed boolean DEFAULT false NOT NULL,
    security boolean DEFAULT false NOT NULL
);



--
-- Name: cots_informations_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cots_informations ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cots_informations_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cpe_matches; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cpe_matches (
    matching_id bigint NOT NULL,
    cpe_id bigint NOT NULL
);



--
-- Name: cve; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cve (
    id bigint NOT NULL,
    cwe character varying(255),
    last_modified timestamp without time zone,
    modified timestamp without time zone,
    name character varying(255) NOT NULL,
    published timestamp without time zone,
    summary character varying(4095),
    status character varying(255)
);



--
-- Name: cve_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cve ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cve_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cvss2_mark; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cvss2_mark (
    id bigint NOT NULL,
    cvss real,
    exploitability_score real,
    impact_score real,
    cve_id bigint,
    vector_id bigint
);


--
-- Name: cvss2_mark_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cvss2_mark ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cvss2_mark_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cvss2_vector; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cvss2_vector (
    id bigint NOT NULL,
    attack_complexity character varying(255),
    attack_vector character varying(255),
    availability character varying(255),
    confidentiality character varying(255),
    integrity character varying(255),
    authentication character varying(255),
    value character varying(255)
);


--
-- Name: cvss2_vector_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cvss2_vector ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cvss2_vector_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cvss3_mark; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cvss3_mark (
    id bigint NOT NULL,
    cvss real,
    exploitability_score real,
    impact_score real,
    cve_id bigint,
    vector_id bigint
);


--
-- Name: cvss3_mark_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cvss3_mark ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cvss3_mark_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: cvss3_vector; Type: TABLE; Schema: public; 
--

CREATE TABLE public.cvss3_vector (
    id bigint NOT NULL,
    attack_complexity character varying(255),
    attack_vector character varying(255),
    availability character varying(255),
    confidentiality character varying(255),
    integrity character varying(255),
    privileges_required character varying(255),
    scope character varying(255),
    user_interaction character varying(255),
    value character varying(255)
);


--
-- Name: cvss3_vector_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.cvss3_vector ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cvss3_vector_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: matchings; Type: TABLE; Schema: public; 
--

CREATE TABLE public.matchings (
    id bigint NOT NULL,
    criteria character varying(255),
    created timestamp without time zone,
    last_modified timestamp without time zone,
    cpe_last_modified timestamp without time zone,
    status character varying(255),
    uuid uuid
);


--
-- Name: matchings_id_seq; Type: SEQUENCE; Schema: public; 
--

ALTER TABLE public.matchings ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.matchings_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: updates; Type: TABLE; Schema: public; 
--

CREATE TABLE public.updates (
    id integer NOT NULL,
    last_update timestamp without time zone,
    name character varying(5)
);


--
-- Name: updates_id_seq; Type: SEQUENCE; Schema: public; 
--

CREATE SEQUENCE public.updates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: updates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; 
--

ALTER SEQUENCE public.updates_id_seq OWNED BY public.updates.id;


--
-- Name: updates id; Type: DEFAULT; Schema: public; 
--

ALTER TABLE ONLY public.updates ALTER COLUMN id SET DEFAULT nextval('public.updates_id_seq'::regclass);


--
-- Name: applicability_analysis cots_analysis_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.applicability_analysis
    ADD CONSTRAINT cots_analysis_pkey PRIMARY KEY (id);


--
-- Name: cots_informations cots_informations_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots_informations
    ADD CONSTRAINT cots_informations_pkey PRIMARY KEY (id);


--
-- Name: cots cots_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots
    ADD CONSTRAINT cots_pkey PRIMARY KEY (id);


--
-- Name: cve cve_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cve
    ADD CONSTRAINT cve_pkey PRIMARY KEY (id);


--
-- Name: cvss2_mark cvss2_mark_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss2_mark
    ADD CONSTRAINT cvss2_mark_pkey PRIMARY KEY (id);


--
-- Name: cvss2_mark cvss2_mark_unicity; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss2_mark
    ADD CONSTRAINT cvss2_mark_unicity UNIQUE (cve_id);


--
-- Name: cvss2_vector cvss2_vector_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss2_vector
    ADD CONSTRAINT cvss2_vector_pkey PRIMARY KEY (id);


--
-- Name: cvss3_mark cvss3_mark_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss3_mark
    ADD CONSTRAINT cvss3_mark_pkey PRIMARY KEY (id);


--
-- Name: cvss3_vector cvss3_vector_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss3_vector
    ADD CONSTRAINT cvss3_vector_pkey PRIMARY KEY (id);


--
-- Name: cots_cves m_key; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots_cves
    ADD CONSTRAINT m_key PRIMARY KEY (cots_id, cves_id);


--
-- Name: matchings match_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.matchings
    ADD CONSTRAINT match_pkey PRIMARY KEY (id);


--
-- Name: cpe_matches matches_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cpe_matches
    ADD CONSTRAINT matches_pkey PRIMARY KEY (matching_id, cpe_id);


--
-- Name: cve uk_dy3mbp8hqmlcncll9gjiuukbg; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cve
    ADD CONSTRAINT uk_dy3mbp8hqmlcncll9gjiuukbg UNIQUE (name);


--
-- Name: cvss3_vector uk_rgithseltsrufujm9mtfe7w6x; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss3_vector
    ADD CONSTRAINT uk_rgithseltsrufujm9mtfe7w6x UNIQUE (value);


--
-- Name: cots unicite_cpe; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots
    ADD CONSTRAINT unicite_cpe UNIQUE (cpe);


--
-- Name: matchings unicite_match_id; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.matchings
    ADD CONSTRAINT unicite_match_id UNIQUE (uuid);


--
-- Name: cvss2_vector unicity; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss2_vector
    ADD CONSTRAINT unicity UNIQUE (value);


--
-- Name: cvss3_mark unicitycve; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss3_mark
    ADD CONSTRAINT unicitycve UNIQUE (cve_id);


--
-- Name: updates updates_pkey; Type: CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.updates
    ADD CONSTRAINT updates_pkey PRIMARY KEY (id);


--
-- Name: cpe_matches cpes_fkey; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cpe_matches
    ADD CONSTRAINT cpes_fkey FOREIGN KEY (cpe_id) REFERENCES public.cots(id);


--
-- Name: cvss3_mark fk115d899xgfh4v6b1x8qqvs48n; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss3_mark
    ADD CONSTRAINT fk115d899xgfh4v6b1x8qqvs48n FOREIGN KEY (cve_id) REFERENCES public.cve(id);


--
-- Name: cots_informations fk6khrec4rosrsnd05va92r9e4m; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots_informations
    ADD CONSTRAINT fk6khrec4rosrsnd05va92r9e4m FOREIGN KEY (id) REFERENCES public.cots_informations(id);


--
-- Name: cots_informations fk7k8evdky5k2s7pdxl8wchgy22; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots_informations
    ADD CONSTRAINT fk7k8evdky5k2s7pdxl8wchgy22 FOREIGN KEY (cots_id) REFERENCES public.cots(id);


--
-- Name: cots_cves fk848vabyjduhhheicto9fn6jpv; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots_cves
    ADD CONSTRAINT fk848vabyjduhhheicto9fn6jpv FOREIGN KEY (cves_id) REFERENCES public.cve(id);


--
-- Name: applicability_analysis fkan3lxb19skd2xpnpry11tcpk3; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.applicability_analysis
    ADD CONSTRAINT fkan3lxb19skd2xpnpry11tcpk3 FOREIGN KEY (cve_id) REFERENCES public.cve(id);


--
-- Name: applicability_analysis fkbs5voswbndc7pv9edbc5fhu97; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.applicability_analysis
    ADD CONSTRAINT fkbs5voswbndc7pv9edbc5fhu97 FOREIGN KEY (cots_id) REFERENCES public.cots(id);


--
-- Name: cvss3_mark fkdge47rxifd7rkv03m6f23rqa5; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss3_mark
    ADD CONSTRAINT fkdge47rxifd7rkv03m6f23rqa5 FOREIGN KEY (vector_id) REFERENCES public.cvss3_vector(id);


--
-- Name: cots_cves fkq94xssd0kqlt4bovi4tx3uwpy; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cots_cves
    ADD CONSTRAINT fkq94xssd0kqlt4bovi4tx3uwpy FOREIGN KEY (cots_id) REFERENCES public.cots(id);


--
-- Name: applicability_analysis fktchl3n8tpo4850jy45r0i1dv5; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.applicability_analysis
    ADD CONSTRAINT fktchl3n8tpo4850jy45r0i1dv5 FOREIGN KEY (id) REFERENCES public.applicability_analysis(id);


--
-- Name: cpe_matches matchings_fkey; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cpe_matches
    ADD CONSTRAINT matchings_fkey FOREIGN KEY (matching_id) REFERENCES public.matchings(id);


--
-- Name: cvss2_mark rhergrgaergdfv5fz5aefarg6; Type: FK CONSTRAINT; Schema: public; 
--

ALTER TABLE ONLY public.cvss2_mark
    ADD CONSTRAINT rhergrgaergdfv5fz5aefarg6 FOREIGN KEY (vector_id) REFERENCES public.cvss2_vector(id);

-- Mandatory first insertions 

INSERT INTO public.updates  (id, name) VALUES ((1, 'CPE'), (2, 'CVE'), (3, 'MATCH')); 

CREATE INDEX cve_index ON cots_cves (cves_id);